<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="favicon.ico">

    <title>TrackCard</title>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap theme -->
    <link href="css/bootstrap-theme.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="theme.css" rel="stylesheet">

    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <script src="assets/js/ie-emulation-modes-warning.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body role="document">

    <!-- Fixed navbar -->
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#" style="font-family:AudiTypeExtendedBold;">TrackCard</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="#">Tracker</a></li>
            <li><a href="#api">API Docs</a></li>
            <li><a href="#buttrackcard">Buy TrackCard</a></li>
            <li><a href="#about">About</a></li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Contact <span class="caret"></span></a>
              <ul class="dropdown-menu">
                <li><a href="#">Action</a></li>
                <li><a href="#">Another action</a></li>
                <li><a href="#">Something else here</a></li>
                <li role="separator" class="divider"></li>
                <li class="dropdown-header">Nav header</li>
                <li><a href="#">Separated link</a></li>
                <li><a href="#">One more separated link</a></li>
              </ul>
            </li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>


  <div class="container theme-showcase" role="main">
    
    <div class="col-sm-12" style="margin-bottom:63px;">
      <img src="images/trackcard_design.png">
      <img src="images/trackcard_design_l1.png" class="light1">
      <img src="images/trackcard_design_l2.png" class="light2">
    </div>

    <div class="row">
      <div class="col-sm-12">
        <div class="col-sm-4">
          <div class="panel panel-success">
            <div class="panel-heading">
              <h3 id="estDelivDateTitle" class="panel-title">Estimated Delivery Date</h3>
            </div>
            <div id="estDelivDate" class="panel-body">
              Tuesday Nov 17, 2015 - On Time
            </div>
          </div>
        </div>
        <div class="col-sm-4">
          <div class="panel panel-info">
            <div class="panel-heading">
              <h3 class="panel-title">Current Location</h3>
            </div>
            <div id="currLoc" class="panel-body">
              Toledo, Ohio, United States
            </div>
          </div>
        </div>
        <div class="col-sm-4">
          <div class="panel panel-success">
            <div class="panel-heading">
              <h3 class="panel-title">Time in Location</h3>
            </div>
            <div id="timeInLoc" class="panel-body">
              +49min
            </div>
          </div>
        </div>
      </div>
    </div>


    <div class="col-sm-12" style="margin-top:43px;">
    <percent id="progressType" style="left:87%;position:relative;top:49px;color:#FFF;">90%</percent>
      <div class="progress" style="height:80px;">
        <div id="progressBar" class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="90" aria-valuemin="0" aria-valuemax="100" style="width: 90%"><span class="sr-only">90% Complete (success)</span></div>
      </div>
    </div>

    <div class="col-sm-12">
      <div id="map" style="height:250px;width:100%;border-radius: 6px;margin-top:43px;"></div>
    </div>

    <div class="col-md-12" style="background-color:#FFF;max-width:1111px;margin-left:15px;margin-top:65px;border-radius: 6px;">
          <table class="table table-striped">
            <thead>
              <tr>
                <th>Location</th>
                <th>Time</th>
                <th>Duration</th>
              </tr>
            </thead>
            <tbody>
              <tr id="detroit" style="display:none;">
                <td>Detroit, Michigan, United States</td>
                <td>Wed Nov 18 1:30pm</td>
                <td>+1min</td>
              </tr>
              <tr>
                <td>Toledo, Ohio, United States</td>
                <td>Wed Nov 18 11:30am</td>
                <td>+49min</td>
              </tr>
              <tr>
                <td>Cleveland, Ohio, United States</td>
                <td>Wed Nov 18 9:30am</td>
                <td>+36min</td>
              </tr>
              <tr>
                <td>Pittsburg, United States</td>
                <td>Wed Nov 17 6:37pm</td>
                <td>+47min</td>
              </tr>
              <tr>
                <td>New York, New York, United States</td>
                <td>Wed Nov 16 7:37pm</td>
                <td>+1day 1hr 22min</td>
              </tr>
              <tr>
                <td>Brussels, Belgium</td>
                <td>Wed Nov 11 1:01pm</td>
                <td>+13hr 11min</td>
              </tr>
              <tr>
                <td>Ingolstadt, Germany</td>
                <td>Wed Nov 10 3:37pm</td>
                <td>+44min</td>
              </tr>
            </tbody>
        </table>
    </div>
  

  </div> <!-- /container -->


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->

    <script async defer src="https://maps.googleapis.com/maps/api/js?callback=initMap">
    </script><!--key=AIzaSyBWZ3ebnBmqZYP1lEO2rN2TojgHR5P738o&-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="assets/js/docs.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="assets/js/ie10-viewport-bug-workaround.js"></script>
    <script src="https://cdn.socket.io/socket.io-1.3.7.js"></script>
    <script type="text/javascript">
  var map;
  
  function initMap(singleton) {
    map = new google.maps.Map(document.getElementById('map'), {
      center: {lat: 44.5, lng: -35.861},
      zoom: 4,
      streetViewControl: false,
    });

    var geocoder= new google.maps.Geocoder();
    geocoder.geocode({ 'address': 'Detroit, United States' }, function (results, status) {
      //var myLatLng = {lat: }
      var marker = new google.maps.Marker({
        position: results[0].geometry.location,
        map: map,
        title: 'Your package is here!'
      });
    });

    //createLine(singleton);
  }

  
  //createLine('Ingolstadt, Germany','Brussels, Belgium');
  //createLine('Brussels, Belgium','New York, United States');
  //createLine('New York, United States','Pittsburgh, United States');
  //createLine('Pittsburgh, United States','Cleveland, Ohio, United States');
  //createLine('Cleveland, United States','Toledo, United States');
  //createLine('Toledo, Ohio, United States','Detroit, United States');


function createLine(singleton) {

  function makeLine(loc, loc2){
    var route = [
      loc,
      loc2
    ];
  
    var polyline = new google.maps.Polyline({
        path: route,
        strokeColor: "#ff0000",
        strokeOpacity: 0.6,
        strokeWeight: 5
    });
  
    polyline.setMap(map);

  }

  for (var i = 1; i < singleton.locs.length; i++) {
    console.log(singleton.locs[i].latlng);

    makeLine(singleton.locs[i-1].latlng, singleton.locs[i].latlng);
    //0 1
    //1 2
    //2 3
    //3 4

  }  
}

function createNewLine(singleton) {

  function makeLine(loc, loc2){
    var route = [
      loc,
      loc2
    ];
  
    var polyline = new google.maps.Polyline({
        path: route,
        strokeColor: "#ff0000",
        strokeOpacity: 0.6,
        strokeWeight: 5
    });
  
    polyline.setMap(map);

  }

  makeLine(singleton.locs[singleton.locs.length-2].latlng, singleton.locs[singleton.locs.length-1].latlng);

}

function addToUi(singleton) {

  document.getElementById('estDelivDateTitle').innerText = 'Delivered';

  document.getElementById('currLoc').innerText = singleton.locs[singleton.locs.length-1].qs.replace(/\+/g, ' ');

  document.getElementById('timeInLoc').innerText = '+1min';

  document.getElementById('progressType').style.left = '96%';

  var percent;
  for (var i = 0; i < 11; i++) {

    percent = 90 + i;
    setTimeout(function(){
      document.getElementById('progressBar').style.width = percent + '%';
      document.getElementById('progressType').innerText = percent + '%';
    }, i*700);

  }

  createNewLine(singleton);

  document.getElementById('detroit').style.display = '';
}

  $.get( "http://localhost/cellular/getdata.json", function( singleton ) {
    console.log( "Data Loaded: " );
    console.dir(singleton);
    initMap(singleton);
    createLine(singleton);
    //addToUi(singleton);
    //initMap(singleton);
    //locTable(singleton);
  });

  var socket = io('http://localhost:8080');
  socket.on('news', function (data) {
    console.log('socketio',data);
  });

</script>
  </body>
</html>